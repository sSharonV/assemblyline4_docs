<!-- Elements added to main will be displayed on all pages -->

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../../../../images/crane.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>How-to: Upgrade Service Updater for Assemblyline 4.1+ - Assemblyline 4</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../../../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-upgrade-service-updater-for-assemblyline-41" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Assemblyline 4" class="md-header__button md-logo" aria-label="Assemblyline 4" data-md-component="logo">
      
  <img src="../../../../../images/crane.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Assemblyline 4
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              How-to: Upgrade Service Updater for Assemblyline 4.1+
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="./" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../../../../../fr/developer_manual/services/advanced/service_updater_upgrade/" hreflang="fr" class="md-select__link">
                    Fran√ßais
                  </a>
                </li>
                
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/CybercentreCanada/assemblyline4_docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../" class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../overview/how_it_works/" class="md-tabs__link">
        Overview
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../user_manual/submitting_file/" class="md-tabs__link">
        User's manual
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../installation/deployment/" class="md-tabs__link">
        Installation
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../administration/signature_management/" class="md-tabs__link">
        Administration
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../integration/ingestion_method/" class="md-tabs__link">
        Integration
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../env/getting_started/" class="md-tabs__link md-tabs__link--active">
        Developer's guide
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Assemblyline 4" class="md-nav__button md-logo" aria-label="Assemblyline 4" data-md-component="logo">
      
  <img src="../../../../../images/crane.png" alt="logo">

    </a>
    Assemblyline 4
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/CybercentreCanada/assemblyline4_docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Overview" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../overview/how_it_works/" class="md-nav__link">
        How it works
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../overview/services/" class="md-nav__link">
        Assemblyline services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../overview/community_services/" class="md-nav__link">
        Community services
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          User's manual
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User's manual" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          User's manual
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_manual/submitting_file/" class="md-nav__link">
        Submitting a file for analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_manual/results/" class="md-nav__link">
        Assemblyline results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_manual/searching/" class="md-nav__link">
        Searching
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/deployment/" class="md-nav__link">
        Choose your deployment type
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/appliance_docker/" class="md-nav__link">
        Appliance installation (Docker)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/appliance/" class="md-nav__link">
        Appliance installation (MicroK8s)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/cluster/" class="md-nav__link">
        Cluster installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" data-md-state="indeterminate" type="checkbox" id="__nav_4_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_5">
          Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Configuration" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/configuration/config_file/" class="md-nav__link">
        Configuration YAML file
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/configuration/authentication/" class="md-nav__link">
        Authentication section
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/configuration/core/" class="md-nav__link">
        Core component section
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/configuration/datasources/" class="md-nav__link">
        Data sources section
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/configuration/datastore/" class="md-nav__link">
        Database section
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/configuration/filestore/" class="md-nav__link">
        File storage section
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/configuration/logging/" class="md-nav__link">
        Logging section
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/configuration/services/" class="md-nav__link">
        Service section
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/configuration/submission/" class="md-nav__link">
        Submission section
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/configuration/system/" class="md-nav__link">
        System section
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/configuration/ui/" class="md-nav__link">
        User Interface section
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/classification_engine/" class="md-nav__link">
        Classification engine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/monitoring/" class="md-nav__link">
        Monitoring with ELK
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" data-md-state="indeterminate" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Administration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Administration" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Administration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administration/signature_management/" class="md-nav__link">
        Signature Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administration/source_management/" class="md-nav__link">
        Signature Source Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administration/service_management/" class="md-nav__link">
        Service management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administration/system_safelist/" class="md-nav__link">
        System safelist
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administration/user_management/" class="md-nav__link">
        User Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administration/troubleshooting/" class="md-nav__link">
        Troubleshooting / FAQ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" data-md-state="indeterminate" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Integration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Integration" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Integration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integration/ingestion_method/" class="md-nav__link">
        Choosing your ingestion method
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integration/key_generation/" class="md-nav__link">
        Generating an API key
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integration/python/" class="md-nav__link">
        Python Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integration/java/" class="md-nav__link">
        Java Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integration/rest/" class="md-nav__link">
        RESTful API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Developer's guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developer's guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Developer's guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" data-md-state="indeterminate" type="checkbox" id="__nav_7_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1">
          Setup Environment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Setup Environment" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Setup Environment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../env/getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_2" data-md-state="indeterminate" type="checkbox" id="__nav_7_1_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1_2">
          VSCode
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="VSCode" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_1_2">
          <span class="md-nav__icon md-icon"></span>
          VSCode
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../env/vscode/setup_script/" class="md-nav__link">
        Setup script
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../env/vscode/use_vscode/" class="md-nav__link">
        Use VSCode
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_3" data-md-state="indeterminate" type="checkbox" id="__nav_7_1_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1_3">
          Pycharm
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pycharm" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_1_3">
          <span class="md-nav__icon md-icon"></span>
          Pycharm
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../env/pycharm/local_development/" class="md-nav__link">
        Local development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../env/pycharm/remote_development/" class="md-nav__link">
        Remote development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../env/pycharm/use_pycharm/" class="md-nav__link">
        Use PyCharm
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" type="checkbox" id="__nav_7_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2">
          Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Services" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developing_an_assemblyline_service/" class="md-nav__link">
        Developing a service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adding_a_service_updater/" class="md-nav__link">
        Adding a Service Updater
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../run_your_service/" class="md-nav__link">
        Run your service
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2_4" type="checkbox" id="__nav_7_2_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2_4">
          Advanced development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced development" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_2_4">
          <span class="md-nav__icon md-icon"></span>
          Advanced development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../service_base/" class="md-nav__link">
        ServiceBase Class
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../service_updater_base/" class="md-nav__link">
        ServiceUpdater Class
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../request/" class="md-nav__link">
        Request Class
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../result/" class="md-nav__link">
        Result Class
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../result_section/" class="md-nav__link">
        ResultSection Class
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../service_manifest/" class="md-nav__link">
        Service manifest
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          How-to: Upgrade Service Updater for Assemblyline 4.1+
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        How-to: Upgrade Service Updater for Assemblyline 4.1+
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#where-do-i-start" class="md-nav__link">
    Where do I start?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-do-i-need-to-keep-from-my-old-updater" class="md-nav__link">
    What do I need to keep from my old updater?
  </a>
  
    <nav class="md-nav" aria-label="What do I need to keep from my old updater?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#importing-into-assemblyine" class="md-nav__link">
    Importing into Assemblyine
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validating-signature-file-optional" class="md-nav__link">
    Validating signature file (Optional)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-there-anything-i-need-to-change-for-the-actual-service-code" class="md-nav__link">
    Is there anything I need to change for the actual service code?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-dont-i-need-to-implement-and-why" class="md-nav__link">
    What don't I need to implement and why?
  </a>
  
    <nav class="md-nav" aria-label="What don't I need to implement and why?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#do_source_update" class="md-nav__link">
    do_source_update()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#do_local_update" class="md-nav__link">
    do_local_update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#do-i-have-to-change-the-service-manifest-for-41" class="md-nav__link">
    Do I have to change the service manifest for 4.1?
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/infrastructure/" class="md-nav__link">
        Infrastructure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/frontend/" class="md-nav__link">
        Frontend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docs/docs/" class="md-nav__link">
        Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#where-do-i-start" class="md-nav__link">
    Where do I start?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-do-i-need-to-keep-from-my-old-updater" class="md-nav__link">
    What do I need to keep from my old updater?
  </a>
  
    <nav class="md-nav" aria-label="What do I need to keep from my old updater?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#importing-into-assemblyine" class="md-nav__link">
    Importing into Assemblyine
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validating-signature-file-optional" class="md-nav__link">
    Validating signature file (Optional)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-there-anything-i-need-to-change-for-the-actual-service-code" class="md-nav__link">
    Is there anything I need to change for the actual service code?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-dont-i-need-to-implement-and-why" class="md-nav__link">
    What don't I need to implement and why?
  </a>
  
    <nav class="md-nav" aria-label="What don't I need to implement and why?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#do_source_update" class="md-nav__link">
    do_source_update()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#do_local_update" class="md-nav__link">
    do_local_update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#do-i-have-to-change-the-service-manifest-for-41" class="md-nav__link">
    Do I have to change the service manifest for 4.1?
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/CybercentreCanada/assemblyline4_docs/edit/master/docs/developer_manual/services/advanced/service_updater_upgrade.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="how-to-upgrade-service-updater-for-assemblyline-41">How-to: Upgrade Service Updater for Assemblyline 4.1+<a class="headerlink" href="#how-to-upgrade-service-updater-for-assemblyline-41" title="Permanent link">&para;</a></h1>
<p>For this tutorial, we'll take an existing official service that was ported to 4.1 as an example <a href="https://github.com/CybercentreCanada/assemblyline-service-sigma/tree/v4.0.1.stable10">Sigma 4.0.1.stable10</a>.</p>
<h2 id="where-do-i-start">Where do I start?<a class="headerlink" href="#where-do-i-start" title="Permanent link">&para;</a></h2>
<p>As a starting point, you would create an instance of the <code>ServiceUpdater</code> class.</p>
<p>We recommend setting a <code>default_pattern (default: *)</code> as this is a fallback if a source didn't provide a pattern when searching for acceptable signature files. In Sigma's case, its signatures are typically in .yml format.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">assemblyline_v4_service.updater.updater</span> <span class="kn">import</span> <span class="n">ServiceUpdater</span>

<span class="k">class</span> <span class="nc">SigmaUpdateServer</span><span class="p">(</span><span class="n">ServiceUpdater</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">import_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files_sha256</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">default_classification</span><span class="p">):</span> <span class="o">-&gt;</span> <span class="kc">None</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="c1">#Returns true always</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">SigmaUpdateServer</span><span class="p">(</span><span class="n">default_pattern</span><span class="o">=</span><span class="s2">&quot;*.yml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">server</span><span class="p">:</span>
        <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div>
<h2 id="what-do-i-need-to-keep-from-my-old-updater">What do I need to keep from my old updater?<a class="headerlink" href="#what-do-i-need-to-keep-from-my-old-updater" title="Permanent link">&para;</a></h2>
<h3 id="importing-into-assemblyine"><em>Importing into Assemblyine</em><a class="headerlink" href="#importing-into-assemblyine" title="Permanent link">&para;</a></h3>
<p>In most cases, the means of importing your signatures into Assemblyline's Signature API will still be needed.
As with the following within the if block, you'll be able to copy-paste that section of code into a <code>import_update()</code> (with obvious changes to variables names to match the definition). Failure to implement a <code>import_update()</code> will raise a NotImplementedError indicating this is a must for an updater.</p>
<p>Starting at line 259 of sigma_updater.py:
<div class="highlight"><pre><span></span><code>    <span class="k">if</span> <span class="n">files_sha256</span><span class="p">:</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found new Sigma rule files to process!&quot;</span><span class="p">)</span>
        <span class="n">sigma_importer</span> <span class="o">=</span> <span class="n">SigmaImporter</span><span class="p">(</span><span class="n">al_client</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">LOGGER</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">source_val</span> <span class="ow">in</span> <span class="n">files_sha256</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">total_imported</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">default_classification</span> <span class="o">=</span> <span class="n">source_default_classification</span><span class="p">[</span><span class="n">source</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">source_val</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">total_imported</span> <span class="o">+=</span> <span class="n">sigma_importer</span><span class="o">.</span><span class="n">import_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">default_classification</span><span class="o">=</span><span class="n">default_classification</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> failed to import due to a Sigma error&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">ComposerError</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> failed to import due to a YAML-parsing error&quot;</span><span class="p">)</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_imported</span><span class="si">}</span><span class="s2"> signatures were imported for source </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No new Sigma rule files to process&#39;</span><span class="p">)</span>
</code></pre></div>
In the new updater:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">assemblyline.common</span> <span class="kn">import</span> <span class="n">forge</span>
<span class="kn">from</span> <span class="nn">assemblyline_v4_service.updater.updater</span> <span class="kn">import</span> <span class="n">ServiceUpdater</span>

<span class="kn">from</span> <span class="nn">sigma_.sigma_importer</span> <span class="kn">import</span> <span class="n">SigmaImporter</span>
<span class="kn">from</span> <span class="nn">pysigma.exceptions</span> <span class="kn">import</span> <span class="n">UnsupportedFeature</span>
<span class="kn">from</span> <span class="nn">yaml.composer</span> <span class="kn">import</span> <span class="n">ComposerError</span>

<span class="n">classification</span> <span class="o">=</span> <span class="n">forge</span><span class="o">.</span><span class="n">get_classification</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">SigmaUpdateServer</span><span class="p">(</span><span class="n">ServiceUpdater</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">import_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files_sha256</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">default_classification</span><span class="o">=</span><span class="n">classification</span><span class="o">.</span><span class="n">UNRESTRICTED</span><span class="p">):</span> <span class="o">-&gt;</span> <span class="kc">None</span>
        <span class="n">sigma_importer</span> <span class="o">=</span> <span class="n">SigmaImporter</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
        <span class="n">total_imported</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">files_sha256</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">total_imported</span> <span class="o">+=</span> <span class="n">sigma_importer</span><span class="o">.</span><span class="n">import_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">default_classification</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> failed to import due to a Sigma error&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ComposerError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> failed to import due to a YAML-parsing error&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">UnsupportedFeature</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_imported</span><span class="si">}</span><span class="s2"> signatures were imported for source </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="c1">#Returns true always</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">SigmaUpdateServer</span><span class="p">(</span><span class="n">default_pattern</span><span class="o">=</span><span class="s2">&quot;*.yml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">server</span><span class="p">:</span>
        <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div></p>
<h3 id="validating-signature-file-optional"><em>Validating signature file (Optional)</em><a class="headerlink" href="#validating-signature-file-optional" title="Permanent link">&para;</a></h3>
<p>Some updaters might've had a means of validating signature files before adding it as part of the signature collection before import.</p>
<p>In Sigma's case, it called <code>val_file</code>, after downloading its signature files by either a URL download or a Git clone. If deemed a valid file for the service, then it would add it as part of the signature collection, otherwise it was ignored.</p>
<p>Starting at line 236 of sigma_updater.py:
<div class="highlight"><pre><span></span><code>            <span class="k">if</span> <span class="n">uri</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.git&#39;</span><span class="p">):</span>
                <span class="n">files</span> <span class="o">=</span> <span class="n">git_clone_repo</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">previous_update</span><span class="o">=</span><span class="n">previous_update</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">sha256</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">files_sha256</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">source_name</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="k">if</span> <span class="n">previous_hash</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">source_name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="n">sha256</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">val_file</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                                <span class="n">files_sha256</span><span class="p">[</span><span class="n">source_name</span><span class="p">][</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">sha256</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> was not imported due to failed validation&quot;</span><span class="p">)</span>
                        <span class="k">except</span> <span class="n">UnsupportedFeature</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">files</span> <span class="o">=</span> <span class="n">url_download</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">previous_update</span><span class="o">=</span><span class="n">previous_update</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">sha256</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">files_sha256</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">source_name</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="k">if</span> <span class="n">previous_hash</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">source_name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="n">sha256</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">val_file</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                            <span class="n">files_sha256</span><span class="p">[</span><span class="n">source_name</span><span class="p">][</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">sha256</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> was not imported due to failed validation&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p>In the new updater, you can override the class' <code>is_valid()</code> call to suit your validation needs:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">yaml.composer</span> <span class="kn">import</span> <span class="n">ComposerError</span>

<span class="kn">from</span> <span class="nn">assemblyline.common</span> <span class="kn">import</span> <span class="n">forge</span>
<span class="kn">from</span> <span class="nn">assemblyline_v4_service.updater.updater</span> <span class="kn">import</span> <span class="n">ServiceUpdater</span>

<span class="kn">from</span> <span class="nn">sigma_.sigma_importer</span> <span class="kn">import</span> <span class="n">SigmaImporter</span>
<span class="kn">from</span> <span class="nn">pysigma.pysigma</span> <span class="kn">import</span> <span class="n">val_file</span>
<span class="kn">from</span> <span class="nn">pysigma.exceptions</span> <span class="kn">import</span> <span class="n">UnsupportedFeature</span>

<span class="n">classification</span> <span class="o">=</span> <span class="n">forge</span><span class="o">.</span><span class="n">get_classification</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">SigmaUpdateServer</span><span class="p">(</span><span class="n">ServiceUpdater</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">import_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files_sha256</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">default_classification</span><span class="o">=</span><span class="n">classification</span><span class="o">.</span><span class="n">UNRESTRICTED</span><span class="p">):</span>
        <span class="n">sigma_importer</span> <span class="o">=</span> <span class="n">SigmaImporter</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
        <span class="n">total_imported</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">files_sha256</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">total_imported</span> <span class="o">+=</span> <span class="n">sigma_importer</span><span class="o">.</span><span class="n">import_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">default_classification</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> failed to import due to a Sigma error&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ComposerError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> failed to import due to a YAML-parsing error&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">UnsupportedFeature</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_imported</span><span class="si">}</span><span class="s2"> signatures were imported for source </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">val_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UnsupportedFeature</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">SigmaUpdateServer</span><span class="p">(</span><span class="n">default_pattern</span><span class="o">=</span><span class="s2">&quot;*.yml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">server</span><span class="p">:</span>
        <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div></p>
<h2 id="is-there-anything-i-need-to-change-for-the-actual-service-code">Is there anything I need to change for the actual service code?<a class="headerlink" href="#is-there-anything-i-need-to-change-for-the-actual-service-code" title="Permanent link">&para;</a></h2>
<p>There would be a need to implement a <code>load_rules()</code> since services can use their rules in different ways so standardizing on a method isn't feasible at the moment.</p>
<p>In the case of Sigma:</p>
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">_load_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">temp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Patch source_name into signature and import</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules_list</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">yaml_fh</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">yaml_fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">source_name</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">patched_rule</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="se">\n</span><span class="s1">signature_source: </span><span class="si">{</span><span class="n">source_name</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">temp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patched_rule</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of rules to be loaded: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">temp_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sigma_parser</span><span class="o">.</span><span class="n">add_signature</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">rule</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of rules successfully loaded: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma_parser</span><span class="o">.</span><span class="n">rules</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Note: After each submission, during a <code>_cleanup()</code>, there is a call made to <code>_download_rules()</code> which will ask your updater if there's new signatures to retrieve. If there's nothing new, then you will proceed to use the same signature set. Otherwise, the service wil retrieve the new set and attempt to load it into the service. For this reason, there can be the need to implement a <code>_clear_rules()</code> to ensure service stability if there was a failure while loading the new set that could have a negative impact on analysis.</p>
<h2 id="what-dont-i-need-to-implement-and-why">What don't I need to implement and why?<a class="headerlink" href="#what-dont-i-need-to-implement-and-why" title="Permanent link">&para;</a></h2>
<h3 id="do_source_update"><code>do_source_update()</code><a class="headerlink" href="#do_source_update" title="Permanent link">&para;</a></h3>
<p>Considering most of our services have the same pattern of:
 1. Establishing a client for Assemblyline using the service_update_account
 2. Iterating over our source list and using either a URL download or Git clone to retrieve signatures
 3. (Optional) If there are rules to be updated, modify the rules before import to add extra metadata or validation
 4. Importing the rules into Assemblyline</p>
<p>We decided to streamline that process for most services while giving service writers the ability to override certain aspects as needed.</p>
<p>The service base contains a set of helper functions for retrieving files during the download process. So you'll notice most services don't need to implement their own <code>do_source_update()</code>, they just need to implement an <code>import_update()</code>. <a href="https://github.com/CybercentreCanada/assemblyline-service-safelist">Safelist</a> is an example of a service that is an exception to this rule where it does implement its own <code>do_source_update()</code>.</p>
<h3 id="do_local_update"><code>do_local_update()</code><a class="headerlink" href="#do_local_update" title="Permanent link">&para;</a></h3>
<p>This particular function doesn't need to be overridden (but you're free to do so) because its primary function is retrieve the signature set from Assemblyline and make it accessible to service instances when they ask for signatures.</p>
<p>This is separate from <code>do_source_update()</code> as that function is meant to retrieve / check for changes from sources outside Assemblyline whereas <code>do_local_update()</code> is checking for internal changes to the signature set (ie. a change in status from 'DEPLOYED' to 'DISABLED').</p>
<p>We invite you to look at the <code>ServiceUpdater</code> code to have a better understanding of how the new service updaters work and how they use the functions you implement (<code>is_valid</code>, <code>import_update</code>).</p>
<h2 id="do-i-have-to-change-the-service-manifest-for-41">Do I have to change the service manifest for 4.1?<a class="headerlink" href="#do-i-have-to-change-the-service-manifest-for-41" title="Permanent link">&para;</a></h2>
<p>Yes, very much so. We've gone away from considering the service updater as a special dependency that needs its own config section.</p>
<p>We now consider it to just be part of the service's list of dependencies, although we reserve the container name 'updates' to indicate this dependency is an updater to the service.</p>
<p>Service Manifest for 4.0:
<div class="highlight"><pre><span></span><code><span class="nt">update_config</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">generates_signatures</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run</span><span class="w"></span>
<span class="w">  </span><span class="nt">run_options</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">allow_internet_access</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;python&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-m&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;sigma_updater&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${REGISTRY}cccs/assemblyline-service-sigma:$SERVICE_TAG</span><span class="w"></span>
<span class="w">  </span><span class="nt">sources</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sigma</span><span class="w"></span>
<span class="w">      </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.*windows\/.*\.yml</span><span class="w"></span>
<span class="w">      </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/SigmaHQ/sigma.git</span><span class="w"></span>
<span class="w">  </span><span class="nt">update_interval_seconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">21600</span><span class="w"> </span><span class="c1"># Quarter-day (every 6 hours)</span><span class="w"></span>
</code></pre></div></p>
<p>will now become in 4.1:
<div class="highlight"><pre><span></span><code><span class="nt">dependencies</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">updates</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">container</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">allow_internet_access</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;python&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-m&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;sigma_.update_server&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${REGISTRY}cccs/assemblyline-service-sigma:$SERVICE_TAG</span><span class="w"></span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;5003&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">run_as_core</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"></span>

<span class="nt">update_config</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">generates_signatures</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">sources</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sigma</span><span class="w"></span>
<span class="w">      </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.*windows\/.*\.yml</span><span class="w"></span>
<span class="w">      </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/SigmaHQ/sigma.git</span><span class="w"></span>
<span class="w">  </span><span class="nt">update_interval_seconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">21600</span><span class="w"> </span><span class="c1"># Quarter-day (every 6 hours)</span><span class="w"></span>
<span class="w">  </span><span class="nt">signature_delimiter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;file&quot;</span><span class="w"></span>
</code></pre></div></p>
<p>Notes:
 - Source management will still be part of the update_config, but container configuration will be moved to a list of dependencies.
 - <code>signature_delimiter</code> indicates how signatures should be separated when downloaded from Assemblyline's Signature API (default: double newline).
    - In Sigma's case, it gets its list of files in the following form: <code>/updates/&lt;random_tempdir&gt;/sigma/&lt;source_name&gt;/&lt;signature_name&gt;</code> where signature_name only contains the signature associated to the name
    - Under the default delimiter, it would get: <code>/updates/&lt;random_tempdir&gt;/sigma/&lt;source_name&gt;</code> where source_name is a compiled list of all signatures from the source separated by double newlines in a single file (which might be fine for some services like YARA and Suricata)</p>
<ul>
<li>In order for updaters to work, they need to be able to communicate with other core components. So you'll need to enable the dependency to be able to <code>run_as_core</code>, otherwise this could lead to issues where the updater isn't able to resolve to other components like Redis and/or Elasticsearch by name.</li>
<li>Setting port(s) helps facilitate communication between the service and its dependency over certain ports and so, as a result, Scaler will create the appropriate NetworkPolicy to ensure communication <strong>only</strong> between a service and its dependencies.</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../service_manifest/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Service manifest" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Service manifest
            </div>
          </div>
        </a>
      
      
        
        <a href="../../../core/infrastructure/" class="md-footer__link md-footer__link--next" aria-label="Next: Infrastructure" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Infrastructure
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.tabs", "navigation.expand", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.b1047164.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js"></script>
      
        <script src="../../../../../javascripts/tables.js"></script>
      
    
  </body>
</html>